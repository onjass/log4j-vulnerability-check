import subprocess
import argparse

def get_args():
    str_description="Check for the vulerable log4j JARs in your system"
    parser = argparse.ArgumentParser(formatter_class=argparse.RawDescriptionHelpFormatter, description=str_description)
    parser.add_argument('-d', '--db_host', help = 'The host where you would like to send the result', required = True)

cmd = "find / -name *jar* | grep 'log4j'"

hash_file = "vulnerable.txt"

cmd = "find / -name *log4j*jar -print 2>/dev/null -exec md5sum {} \;"
result = subprocess.Popen(cmd,shell=True,stdout=subprocess.PIPE,stderr=subprocess.STDOUT).communicate()[0]

with open(hash_file) as file: # Use file to refer to the file object
    data = file.read()


vulnerable = []


for line in result.decode('UTF-8').splitlines():
    line = str(line)
    #print(line)
    elems = line.split(' ')
    if len(elems) > 1:
        file_name = elems[2]
        hash_value = str(elems[0])
        print (file_name)
        print(hash_value)
        hash_value = "152ecb3ce094ac5bc9ea39d6122e2814"
        if hash_value in data:
            vulnerable.append([hash_value,file_name])
            print ("VULN")


print (vulnerable)
